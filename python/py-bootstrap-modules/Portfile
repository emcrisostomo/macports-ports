# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           python 1.0

name                py-bootstrap-modules
version             2021-10-28
revision            1
maintainers         jmr
license             MIT
supported_archs     noarch

description         bootstrap PEP 517 module builds

long_description    This is a set of Python modules that are needed \
                    to do PEP 517 building and wheel installation. \
                    They have to be installed together to enable \
                    bootstrapping, because of circular dependencies.

homepage            https://www.macports.org/

python.versions     36 37 38 39 310

if {$subport ne $name} {
    set flit_core_vers 3.4.0
    set pep517_vers 0.12.0
    set python-install_vers 0.0.3
    set tomli_vers  1.2.2
    set wheel_vers  0.37.0

    master_sites    pypi:f/flit_core:flit_core \
                    pypi:p/pep517:pep517 \
                    pypi:p/python-install:install \
                    pypi:t/tomli:tomli \
                    pypi:w/wheel:wheel

    distfiles       flit_core-${flit_core_vers}.tar.gz:flit_core \
                    pep517-${pep517_vers}.tar.gz:pep517 \
                    python-install-${python-install_vers}.tar.gz:install \
                    tomli-${tomli_vers}.tar.gz:tomli \
                    wheel-${wheel_vers}.tar.gz:wheel

    checksums       flit_core-${flit_core_vers}.tar.gz \
                        md5 a4bb11b54bcf029ec2cd5cb981c07ded \
                        rmd160 f8c8435049941067c60e6e5d9931e0924b2c3d93 \
                        sha256 29468fa2330969167d1f5c23eb9c0661cb6dacfcd46f361a274609a7f4197530 \
                    pep517-${pep517_vers}.tar.gz \
                        md5 7ed0adb5f737c316e071d48d66329a5d \
                        rmd160 f98bf5793c9337653db51635b9ff356cab65129b \
                        sha256 931378d93d11b298cf511dd634cf5ea4cb249a28ef84160b3247ee9afb4e8ab0 \
                    python-install-${python-install_vers}.tar.gz \
                        md5 c591174ae1f14c05ddcc84483381aa7e \
                        rmd160 203ac0ef46cfcfb6e531548a50cc5a05deb9f049 \
                        sha256 926f9e0cb959203629ba6ffdc889f96e1a075c36ca6e7528ba7be96ade189a7d \
                    tomli-${tomli_vers}.tar.gz \
                        md5 e9294a68fea7bb45afdff37c9951ccc5 \
                        rmd160 e37cff10eb7e7f050049585b3d7224dd907b463c \
                        sha256 c6ce0015eb38820eaf32b5db832dbc26deb3dd427bd5f6556cf0acac2c214fee \
                    wheel-${wheel_vers}.tar.gz \
                        md5 79f55b898e6f274f5586bbde39f6fe8e \
                        rmd160 afeb0108d1426828bd37b75d912025df2cd57804 \
                        sha256 e2ef7239991699e3355d54f8e968a21bb940a1dbf34a4d226741e64462516fad

    # Extra dependencies of pep517 on older pythons - maybe not
    # actually needed for basic builds? Seeing what happens without them.
    if {0 && ${python.version} < 38} {
        set importlib_metadata_vers 4.8.1
        license-append  Apache-2
        set packaging_vers 21.0
        set parsing_vers 3.0.1
        set setuptools_scm_vers 6.3.2
        set six_vers 1.16.0
        set typing_extensions_vers 3.10.0.2
        license-append  PSF
        set zipp_vers 3.6.0

        master_sites-append pypi:i/importlib_metadata:importlib_metadata \
                            pypi:p/packaging:packaging \
                            pypi:p/pyparsing:parsing \
                            pypi:s/setuptools_scm:setuptools_scm \
                            pypi:s/six:six \
                            pypi:t/typing_extensions:typing_extensions \
                            pypi:z/zipp:zipp

        distfiles-append    importlib_metadata-${importlib_metadata_vers}.tar.gz:importlib_metadata \
                            packaging-${packaging_vers}.tar.gz:packaging \
                            pyparsing-${parsing_vers}.tar.gz:parsing \
                            setuptools_scm-${setuptools_scm_vers}.tar.gz:setuptools_scm \
                            six-${six_vers}.tar.gz:six \
                            typing_extensions-${typing_extensions_vers}.tar.gz:typing_extensions \
                            zipp-${zipp_vers}.tar.gz:zipp

        checksums-append    importlib_metadata-${importlib_metadata_vers}.tar.gz \
                                md5 5b944bce3fccaf848f0cba7a07f850a1 \
                                rmd160 8b0f8acd7ed578abb878fd85077ece9576b1c02f \
                                sha256 f284b3e11256ad1e5d03ab86bb2ccd6f5339688ff17a4d797a0fe7df326f23b1 \
                            packaging-${packaging_vers}.tar.gz \
                                md5 240ba5823ed31051a1254e74c9d18d55 \
                                rmd160 c841981960c81cde8517af856fa7e73a07bd31e3 \
                                sha256 7dc96269f53a4ccec5c0670940a4281106dd0bb343f47b7471f779df49c2fbe7 \
                            pyparsing-${parsing_vers}.tar.gz \
                                md5 e1a8c5ecb51dd87472362ff6ce575675 \
                                rmd160 a753503d9042e9a32943504aa5e876178c2e6e60 \
                                sha256 84196357aa3566d64ad123d7a3c67b0e597a115c4934b097580e5ce220b91531 \
                            setuptools_scm-${setuptools_scm_vers}.tar.gz \
                                md5 32918d8ac566360c21411e0b3556c695 \
                                rmd160 cc94a6930135ed2f59dbd96cb747302173eaf26f \
                                sha256 a49aa8081eeb3514eb9728fa5040f2eaa962d6c6f4ec9c32f6c1fba88f88a0f2 \
                            six-${six_vers}.tar.gz \
                                md5 a7c927740e4964dd29b72cebfc1429bb \
                                rmd160 ad79fa25e141856d4a384c4b2476f7e41a91ba98 \
                                sha256 1e61c37477a1626458e36f7b1d82aa5c9b094fa4802892072e49de9c60c4c926 \
                            typing_extensions-${typing_extensions_vers}.tar.gz \
                                md5 ed80ecc8eac5cb15840535ca54eb43f3 \
                                rmd160 b9ba0200913df912b7cb026177a7dc428880b180 \
                                sha256 49f75d16ff11f1cd258e1b988ccff82a3ca5570217d7ad8c5f48205dd99a677e \
                            zipp-${zipp_vers}.tar.gz \
                                md5 8d5cf6eb3270384ae13a6440797ea564 \
                                rmd160 7203de20b31173e32d6c0876d1537e0b147eada8 \
                                sha256 71c644c5369f4a6e07636f0aa966270449561fcea2e3d6747b8d23efaa9d7832
    }

    patch {
        system -W ${workpath}/pep517-${pep517_vers} "patch -p0 < ${filespath}/no-deps-option.diff"
        system -W ${workpath}/python-install-${python-install_vers} "patch -p0 < ${filespath}/patch-install-__init__.py.diff"
    }

    build {}
    destroot {
        set instdir ${prefix}/share/${subport}
        xinstall -m 755 -d ${destroot}${instdir}
        copy ${workpath}/flit_core-${flit_core_vers}/flit_core \
            ${workpath}/pep517-${pep517_vers}/pep517 \
            ${workpath}/python-install-${python-install_vers}/install \
            ${workpath}/tomli-${tomli_vers}/tomli \
            ${workpath}/wheel-${wheel_vers}/src/wheel \
            ${workpath}/wheel-${wheel_vers}/src/wheel.egg-info \
            ${destroot}${instdir}

        if {0 && ${python.version} < 38} {
            copy ${workpath}/importlib_metadata-${importlib_metadata_vers}/importlib_metadata \
                ${workpath}/packaging-${packaging_vers}/packaging \
                ${workpath}/pyparsing-${parsing_vers}/pyparsing \
                ${workpath}/setuptools_scm-${setuptools_scm_vers}/src/setuptools_scm \
                ${workpath}/six-${six_vers}/six.py \
                ${workpath}/typing_extensions-${typing_extensions_vers}/src_py3/typing_extensions.py \
                ${workpath}/zipp-${zipp_vers}/zipp.py \
                ${destroot}${instdir}
        }
    }
}

livecheck.type      none
