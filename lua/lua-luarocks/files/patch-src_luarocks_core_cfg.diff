--- src/luarocks/core/cfg.lua.orig	2021-04-13 21:53:35.000000000 +0000
+++ src/luarocks/core/cfg.lua	2021-05-26 17:45:27.000000000 +0000
@@ -349,11 +349,11 @@
       defaults.static_lib_extension = "a"
       defaults.external_lib_extension = "so"
       defaults.obj_extension = "o"
-      defaults.external_deps_dirs = { "/usr/local", "/usr", "/" }
+      defaults.external_deps_dirs = { "%PREFIX%" }
       defaults.variables.CFLAGS = "-O2"
       defaults.cmake_generator = "Unix Makefiles"
-      defaults.variables.CC = "gcc"
-      defaults.variables.LD = "gcc"
+      defaults.variables.CC = "%CC%"
+      defaults.variables.LD = "%CC%"
       defaults.gcc_rpath = true
       defaults.variables.LIBFLAG = "-shared"
       defaults.variables.TEST = "test"
@@ -448,8 +448,8 @@
       else
          defaults.gcc_rpath = false
       end
-      defaults.variables.CC = "env MACOSX_DEPLOYMENT_TARGET="..tostring(version).." gcc"
-      defaults.variables.LD = "env MACOSX_DEPLOYMENT_TARGET="..tostring(version).." gcc"
+      defaults.variables.CC = "env MACOSX_DEPLOYMENT_TARGET="..tostring(version).." %CC%"
+      defaults.variables.LD = "env MACOSX_DEPLOYMENT_TARGET="..tostring(version).." %CC%"
       defaults.web_browser = "open"
    end
 
