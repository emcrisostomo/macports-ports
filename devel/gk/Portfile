# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github 1.0

github.setup            gitkraken gk-cli 3.1.40 v
name                    gk
github.tarball_from     releases

categories              devel
license                 CCBY-3
installs_libs           no
maintainers             {@sergiolms}\
                        openmaintainer

supported_archs         x86_64 arm64

description             Official CLI for GitKraken
long_description        ${name} is GitKraken on the command line. It makes working across multiple \
                        repos easier with Workspaces, provides access to pull requests and \
                        issues from multiple services (GitHub, GitLab, Bitbucket, etc.), \
                        and seamlessly connects with GitKraken Client and GitLens in VS Code \
                        to visualize git information when you need it.

if {${build_arch} eq "x86_64"} {
    # file name is "amd64" for x86_64
    set arch_filename   amd64
    checksums           rmd160  7ccc046983157616e9ce6392779fa328cecd15d2 \
                        sha256  e872056ab4daa7fb20c461460af5e1ff1ea23aed9f2e94afc5e7194d17605aad \
                        size    7616535
} else {
    # arm64
    set arch_filename ${build_arch}
    checksums           rmd160  96ba74f3077c781559db67fb9cebcd548ef006c7 \
                        sha256  929dc5fa93ab9c3a9ddaa95ae97452336f243c3304bf0ed20a6fe997356fad12 \
                        size    7065473
}

distfiles               ${name}_${version}_darwin_${arch_filename}.zip
extract.mkdir           yes
use_zip                 yes

use_configure           no
build                   {}

destroot {
    xinstall -m 0755 ${worksrcpath}/gk ${destroot}${prefix}/bin
    # All supported shells: bash, fish, powershell, zsh
    set comp_path(bash) ${destroot}${prefix}/share/bash-completion/completions/${name}
    set comp_path(fish) ${destroot}${prefix}/share/fish/completions/${name}.fish
    set comp_path(zsh)  ${destroot}${prefix}/share/zsh/site-functions/_${name}
    foreach shell {bash fish zsh} {
        xinstall -d [file dirname $comp_path(${shell})]
        system -W ${worksrcpath} "./${name} completion ${shell} > $comp_path(${shell})"
    }
}

github.livecheck.regex  {([0-9.]+)}
