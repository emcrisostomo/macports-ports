# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github 1.0

github.setup            gitkraken gk-cli 3.1.14 v
name                    gk
github.tarball_from     releases

categories              devel
license                 CCBY-3
installs_libs           no
maintainers             {@sergiolms}\
                        openmaintainer

supported_archs         x86_64 arm64

description             Official CLI for GitKraken
long_description        ${name} is GitKraken on the command line. It makes working across multiple \
                        repos easier with Workspaces, provides access to pull requests and \
                        issues from multiple services (GitHub, GitLab, Bitbucket, etc.), \
                        and seamlessly connects with GitKraken Client and GitLens in VS Code \
                        to visualize git information when you need it.

if {${build_arch} eq "x86_64"} {
    # file name is "amd64" for x86_64
    set arch_filename   amd64
    checksums           rmd160  844c3ccd6b2fd2762c9ebc5f10417dc54a04ee64 \
                        sha256  b869447eddd524e5ac189467a544bce4c2796b55e98bf0d5a65baf28e1ebc5aa \
                        size    6676914
} else {
    # arm64
    set arch_filename ${build_arch}
    checksums           rmd160  8cf00a836d3f8a680d035083aaf28eeaf871ccc5 \
                        sha256  04c7dd02471b01b16e826b251bd37af6c2cfe9f3a49076ae22a216b3bc99eaa7 \
                        size    6170801
}

distfiles               ${name}_${version}_darwin_${arch_filename}.zip
extract.mkdir           yes
use_zip                 yes

use_configure           no
build                   {}

destroot {
    xinstall -m 0755 ${worksrcpath}/gk ${destroot}${prefix}/bin
    # All supported shells: bash, fish, powershell, zsh
    set comp_path(bash) ${destroot}${prefix}/share/bash-completion/completions/${name}
    set comp_path(fish) ${destroot}${prefix}/share/fish/completions/${name}.fish
    set comp_path(zsh)  ${destroot}${prefix}/share/zsh/site-functions/_${name}
    foreach shell {bash fish zsh} {
        xinstall -d [file dirname $comp_path(${shell})]
        system -W ${worksrcpath} "./${name} completion ${shell} > $comp_path(${shell})"
    }
}

github.livecheck.regex  {([0-9.]+)}
